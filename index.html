<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coatings Estimator — The Concrete Protector</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ═══════════════════════════════════════════════════════
   DESIGN SYSTEM
   ═══════════════════════════════════════════════════════ */
:root {
  /* Surface layers */
  --bg: #09090b;
  --s1: #111113;
  --s2: #18181b;
  --s3: #1f1f23;
  --s4: #27272a;
  /* Borders */
  --b1: rgba(255,255,255,.06);
  --b2: rgba(255,255,255,.1);
  --b3: rgba(255,255,255,.15);
  /* Text */
  --t1: #fafafa;
  --t2: #a1a1aa;
  --t3: #71717a;
  --t4: #52525b;
  /* Accent */
  --accent: #f59e0b;
  --accent2: #fbbf24;
  --accent-glow: rgba(245,158,11,.15);
  --accent-glow2: rgba(245,158,11,.08);
  /* Pipeline */
  --lead: #3b82f6;
  --lead-soft: rgba(59,130,246,.12);
  --est: #f97316;
  --est-soft: rgba(249,115,22,.12);
  --proj: #10b981;
  --proj-soft: rgba(16,185,129,.12);
  --comp: #ef4444;
  --comp-soft: rgba(239,68,68,.12);
  /* Semantic */
  --success: #10b981;
  --danger: #ef4444;
  --info: #3b82f6;
  /* Glass */
  --glass: rgba(255,255,255,.03);
  --glass2: rgba(255,255,255,.05);
  /* Radius */
  --r-sm: 8px;
  --r-md: 12px;
  --r-lg: 16px;
  --r-xl: 20px;
  /* Shadow */
  --shadow-sm: 0 1px 2px rgba(0,0,0,.3);
  --shadow-md: 0 4px 12px rgba(0,0,0,.4);
  --shadow-lg: 0 8px 32px rgba(0,0,0,.5);
  --shadow-glow: 0 0 40px rgba(245,158,11,.06);
}

/* ═══════════════════════════════════════════════════════
   RESET
   ═══════════════════════════════════════════════════════ */
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--t1);line-height:1.6;min-height:100vh;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--s4);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--t4)}
::selection{background:rgba(245,158,11,.25);color:var(--t1)}

/* ═══════════════════════════════════════════════════════
   HEADER
   ═══════════════════════════════════════════════════════ */
.hdr{
  position:sticky;top:0;z-index:100;
  background:rgba(9,9,11,.82);
  backdrop-filter:blur(20px) saturate(1.4);
  -webkit-backdrop-filter:blur(20px) saturate(1.4);
  border-bottom:1px solid var(--b1);
  padding:0 32px;
}
.hi{
  max-width:1280px;margin:0 auto;
  display:flex;align-items:center;justify-content:space-between;
  height:56px;gap:16px;
}
.hdr-left{display:flex;align-items:center;gap:12px;cursor:pointer;-webkit-user-select:none;user-select:none}
.hdr-logo{
  width:32px;height:32px;border-radius:8px;
  background:linear-gradient(135deg,var(--accent),#d97706);
  display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:14px;color:#000;
  box-shadow:0 0 20px rgba(245,158,11,.2);
  flex-shrink:0;
}
.hdr h1{font-size:15px;font-weight:700;letter-spacing:-.3px;color:var(--t1)}
.hdr .sub{font-size:11px;color:var(--t3);font-weight:400;letter-spacing:.2px}
.hdr-right{display:flex;align-items:center;gap:6px}
.hdr-btn{
  padding:6px 14px;border-radius:var(--r-sm);
  font-size:12px;font-weight:500;cursor:pointer;
  transition:all .15s ease;border:1px solid var(--b2);
  background:var(--glass2);color:var(--t2);
  font-family:inherit;
}
.hdr-btn:hover{background:var(--b2);color:var(--t1);border-color:var(--b3)}
.hdr-btn.primary{
  background:linear-gradient(135deg,var(--accent),#d97706);
  border-color:transparent;color:#000;font-weight:600;
}
.hdr-btn.primary:hover{filter:brightness(1.1);box-shadow:0 0 20px rgba(245,158,11,.25)}

/* ═══════════════════════════════════════════════════════
   BREADCRUMB
   ═══════════════════════════════════════════════════════ */
.breadcrumb{
  max-width:1280px;margin:0 auto;padding:12px 32px 0;
  display:flex;align-items:center;gap:6px;flex-wrap:wrap;
  font-size:12px;color:var(--t4);
}
.breadcrumb span{cursor:pointer;transition:color .15s;padding:2px 0}
.breadcrumb span:hover{color:var(--accent)}
.breadcrumb .sep{opacity:.3;cursor:default;font-size:10px}
.breadcrumb .sep:hover{color:var(--t4)}
.breadcrumb .current{color:var(--t2);cursor:default;font-weight:500}
.breadcrumb .current:hover{color:var(--t2)}

/* ═══════════════════════════════════════════════════════
   LAYOUT
   ═══════════════════════════════════════════════════════ */
.mc{max-width:1280px;margin:0 auto;padding:24px 32px 100px}
.screen{display:none;animation:screenIn .3s ease}
.screen.ac{display:block}
@keyframes screenIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* ═══════════════════════════════════════════════════════
   SECTION HEADERS
   ═══════════════════════════════════════════════════════ */
.sh{margin-bottom:24px}
.sh h2{font-size:22px;font-weight:700;letter-spacing:-.5px;margin-bottom:4px}
.sh p{font-size:13px;color:var(--t3);max-width:600px;font-weight:400}

/* ═══════════════════════════════════════════════════════
   HOME — FOLDER CARDS
   ═══════════════════════════════════════════════════════ */
.folder-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:32px}
.folder{
  position:relative;overflow:hidden;
  background:var(--s2);
  border:1px solid var(--b1);
  border-radius:var(--r-lg);
  padding:24px 22px;
  cursor:pointer;
  transition:all .2s ease;
}
.folder:hover{
  transform:translateY(-2px);
  box-shadow:var(--shadow-lg);
  border-color:var(--b2);
}
.folder::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  opacity:.8;transition:opacity .2s;
}
.folder:hover::before{opacity:1}
.folder .f-glow{
  position:absolute;top:-40px;right:-40px;width:120px;height:120px;
  border-radius:50%;filter:blur(50px);opacity:.15;pointer-events:none;
  transition:opacity .3s;
}
.folder:hover .f-glow{opacity:.25}
.folder .f-icon{
  width:40px;height:40px;border-radius:var(--r-md);
  display:flex;align-items:center;justify-content:center;
  font-size:18px;margin-bottom:14px;
  backdrop-filter:blur(8px);
}
.folder .f-count{
  font-family:'JetBrains Mono',monospace;
  font-size:28px;font-weight:700;letter-spacing:-1px;
  margin-bottom:2px;
}
.folder .f-label{font-size:13px;font-weight:600;margin-bottom:2px}
.folder .f-sub{font-size:11px;color:var(--t4);font-weight:400}

.folder.lead::before{background:linear-gradient(90deg,var(--lead),transparent)}
.folder.lead .f-glow{background:var(--lead)}
.folder.lead .f-icon{background:var(--lead-soft);color:var(--lead)}
.folder.lead .f-count{color:var(--lead)}
.folder.lead .f-label{color:var(--lead)}
.folder.lead:hover{border-color:rgba(59,130,246,.25)}

.folder.est::before{background:linear-gradient(90deg,var(--est),transparent)}
.folder.est .f-glow{background:var(--est)}
.folder.est .f-icon{background:var(--est-soft);color:var(--est)}
.folder.est .f-count{color:var(--est)}
.folder.est .f-label{color:var(--est)}
.folder.est:hover{border-color:rgba(249,115,22,.25)}

.folder.proj::before{background:linear-gradient(90deg,var(--proj),transparent)}
.folder.proj .f-glow{background:var(--proj)}
.folder.proj .f-icon{background:var(--proj-soft);color:var(--proj)}
.folder.proj .f-count{color:var(--proj)}
.folder.proj .f-label{color:var(--proj)}
.folder.proj:hover{border-color:rgba(16,185,129,.25)}

.folder.comp::before{background:linear-gradient(90deg,var(--comp),transparent)}
.folder.comp .f-glow{background:var(--comp)}
.folder.comp .f-icon{background:var(--comp-soft);color:var(--comp)}
.folder.comp .f-count{color:var(--comp)}
.folder.comp .f-label{color:var(--comp)}
.folder.comp:hover{border-color:rgba(239,68,68,.25)}

.folder.inactive{opacity:.35;border-style:dashed}
.folder.inactive:hover{opacity:.6}
.inactive-label{
  font-size:11px;font-weight:500;text-transform:uppercase;
  letter-spacing:1.5px;color:var(--t4);margin-bottom:8px;padding-left:2px;
}

/* ═══════════════════════════════════════════════════════
   CARDS
   ═══════════════════════════════════════════════════════ */
.cd{
  background:var(--s2);
  border:1px solid var(--b1);
  border-radius:var(--r-lg);
  padding:22px;margin-bottom:14px;
  transition:border-color .15s;
}
.cd:hover{border-color:var(--b2)}
.ct{
  font-size:12px;font-weight:600;letter-spacing:.5px;text-transform:uppercase;
  color:var(--t3);margin-bottom:16px;
  display:flex;align-items:center;gap:8px;
}
.ct .ic{
  width:28px;height:28px;border-radius:var(--r-sm);
  display:flex;align-items:center;justify-content:center;
  font-size:14px;flex-shrink:0;
}
.io{background:var(--accent-glow);color:var(--accent)}
.ig{background:var(--proj-soft);color:var(--proj)}
.ib{background:var(--lead-soft);color:var(--lead)}
.ir{background:var(--comp-soft);color:var(--comp)}
.ior{background:var(--est-soft);color:var(--est)}

/* ═══════════════════════════════════════════════════════
   FORM INPUTS
   ═══════════════════════════════════════════════════════ */
.fg{margin-bottom:14px}
.fg label{
  display:block;font-size:11px;font-weight:500;
  text-transform:uppercase;letter-spacing:.8px;
  color:var(--t3);margin-bottom:6px;
}
.fg input,.fg select,.fg textarea{
  width:100%;
  background:var(--s1);
  border:1px solid var(--b1);
  border-radius:var(--r-sm);
  color:var(--t1);
  font-family:'Inter',system-ui,sans-serif;
  font-size:14px;font-weight:400;
  padding:10px 14px;
  transition:all .15s ease;
  resize:vertical;
}
.fg input::placeholder,.fg textarea::placeholder{color:var(--t4)}
.fg input:focus,.fg select:focus,.fg textarea:focus{
  outline:none;border-color:var(--accent);
  box-shadow:0 0 0 3px var(--accent-glow),var(--shadow-sm);
  background:var(--s2);
}
.fg select{cursor:pointer}
.fg textarea{min-height:72px;line-height:1.5}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
.g4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}

/* ═══════════════════════════════════════════════════════
   SEARCH
   ═══════════════════════════════════════════════════════ */
.search-bar{margin-bottom:0}
.search-bar input{
  width:100%;
  background:var(--s2);
  border:1px solid var(--b1);
  border-radius:var(--r-md);
  padding:11px 14px 11px 40px;
  color:var(--t1);font-size:14px;
  font-family:'Inter',system-ui,sans-serif;
  transition:all .15s;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2352525b' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85zm-5.242.156a5 5 0 1 1 0-10 5 5 0 0 1 0 10z'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:14px center;
}
.search-bar input:focus{
  outline:none;border-color:var(--accent);
  box-shadow:0 0 0 3px var(--accent-glow);background-color:var(--s3);
}

/* ═══════════════════════════════════════════════════════
   LIST ITEMS
   ═══════════════════════════════════════════════════════ */
.list-item{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 18px;
  background:var(--s2);border:1px solid var(--b1);
  border-radius:var(--r-md);margin-bottom:6px;
  cursor:pointer;transition:all .15s ease;
}
.list-item:hover{
  background:var(--s3);border-color:var(--b2);
  transform:translateX(2px);
}
.li-left{display:flex;align-items:center;gap:14px;min-width:0}
.li-avatar{
  width:38px;height:38px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-size:13px;font-weight:700;flex-shrink:0;letter-spacing:-.5px;
}
.li-avatar.lead{background:var(--lead-soft);color:var(--lead)}
.li-avatar.est{background:var(--est-soft);color:var(--est)}
.li-avatar.proj{background:var(--proj-soft);color:var(--proj)}
.li-avatar.comp{background:var(--comp-soft);color:var(--comp)}
.li-name{font-weight:600;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.li-meta{font-size:12px;color:var(--t3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:1px}
.li-right{text-align:right;flex-shrink:0;margin-left:16px}
.li-amount{font-family:'JetBrains Mono',monospace;font-weight:600;font-size:14px;color:var(--accent)}
.li-badge{
  display:inline-block;font-size:10px;font-weight:600;
  text-transform:uppercase;letter-spacing:.5px;
  padding:2px 8px;border-radius:6px;margin-top:4px;
}
.li-badge.lead{background:var(--lead-soft);color:var(--lead)}
.li-badge.est{background:var(--est-soft);color:var(--est)}
.li-badge.proj{background:var(--proj-soft);color:var(--proj)}
.li-badge.comp{background:var(--comp-soft);color:var(--comp)}

/* ═══════════════════════════════════════════════════════
   STATUS PILLS
   ═══════════════════════════════════════════════════════ */
.status-bar{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.status-pill{
  font-size:12px;font-weight:500;
  padding:6px 16px;border-radius:100px;
  cursor:pointer;transition:all .15s;
  border:1px solid var(--b2);
  background:transparent;color:var(--t3);
  font-family:inherit;
}
.status-pill:hover{background:var(--glass2);color:var(--t2)}
.status-pill.active{font-weight:600}
.status-pill.active.lead{background:var(--lead-soft);color:var(--lead);border-color:rgba(59,130,246,.3)}
.status-pill.active.est{background:var(--est-soft);color:var(--est);border-color:rgba(249,115,22,.3)}
.status-pill.active.proj{background:var(--proj-soft);color:var(--proj);border-color:rgba(16,185,129,.3)}
.status-pill.active.comp{background:var(--comp-soft);color:var(--comp);border-color:rgba(239,68,68,.3)}

.active-toggle{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--t3);font-weight:500}
.toggle{position:relative;width:36px;height:20px;flex-shrink:0}
.toggle input{opacity:0;width:0;height:0}
.toggle .slider{
  position:absolute;inset:0;
  background:var(--s4);
  border-radius:20px;cursor:pointer;
  transition:all .2s ease;
}
.toggle .slider::before{
  content:'';position:absolute;
  width:16px;height:16px;left:2px;top:2px;
  background:var(--t3);border-radius:50%;
  transition:all .2s ease;
}
.toggle input:checked+.slider{background:var(--accent)}
.toggle input:checked+.slider::before{transform:translateX(16px);background:#fff}

/* ═══════════════════════════════════════════════════════
   SYSTEM CARDS
   ═══════════════════════════════════════════════════════ */
.sys-card{
  background:var(--s2);border:1px solid var(--b1);
  border-radius:var(--r-md);padding:16px 20px;
  margin-bottom:8px;cursor:pointer;transition:all .15s;
  display:flex;justify-content:space-between;align-items:center;
  border-left:3px solid var(--b1);
}
.sys-card:hover{background:var(--s3);border-color:var(--b2);transform:translateX(2px)}
.sys-card.has-product{border-left-color:var(--accent)}
.sys-area{font-size:14px;font-weight:600}
.sys-detail{font-size:12px;color:var(--t3);margin-top:2px}
.sys-right{text-align:right;flex-shrink:0;margin-left:20px}
.sys-price{font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:700;color:var(--accent)}
.sys-cost{font-size:11px;color:var(--t4);margin-top:2px}

/* ═══════════════════════════════════════════════════════
   ESTIMATE TOTAL BAR
   ═══════════════════════════════════════════════════════ */
.est-total{
  background:linear-gradient(135deg,var(--s2),var(--s3));
  border:1px solid var(--b2);
  border-radius:var(--r-lg);
  padding:22px 26px;margin-bottom:18px;
  display:flex;justify-content:space-between;align-items:center;
  flex-wrap:wrap;gap:16px;
  position:relative;overflow:hidden;
}
.est-total::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,var(--accent),transparent);
}
.est-total-left{font-size:12px;font-weight:500;color:var(--t3);text-transform:uppercase;letter-spacing:.8px}
.est-total-amount{
  font-family:'JetBrains Mono',monospace;
  font-size:28px;font-weight:700;color:var(--accent);
  letter-spacing:-1px;
  text-shadow:0 0 40px rgba(245,158,11,.15);
}
.est-total-detail{font-size:12px;color:var(--t4);margin-top:4px}

/* ═══════════════════════════════════════════════════════
   PRODUCT SELECTOR
   ═══════════════════════════════════════════════════════ */
.prod-option{
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 16px;
  background:var(--s1);border:1px solid var(--b1);
  border-radius:var(--r-sm);margin-bottom:4px;
  cursor:pointer;transition:all .15s;
}
.prod-option:hover{background:var(--s3);border-color:var(--b2)}
.prod-option.sel{
  background:var(--accent-glow2);
  border-color:rgba(245,158,11,.25);
  box-shadow:0 0 0 1px rgba(245,158,11,.1);
}
.prod-name{font-weight:500;font-size:13px}
.prod-sku{font-size:11px;color:var(--t4);font-family:'JetBrains Mono',monospace;margin-top:1px}
.prod-prices{text-align:right;font-size:12px}
.prod-prices .cost{color:var(--comp);font-family:'JetBrains Mono',monospace;font-weight:600}
.prod-prices .sell{color:var(--t3);font-family:'JetBrains Mono',monospace;font-size:11px;margin-top:1px}
.series-filter{display:flex;gap:4px;margin-bottom:14px;flex-wrap:wrap}
.sf-btn{
  font-size:11px;font-weight:500;letter-spacing:.3px;
  padding:5px 12px;border:1px solid var(--b1);
  border-radius:100px;background:transparent;color:var(--t3);
  cursor:pointer;transition:all .15s;font-family:inherit;
}
.sf-btn:hover{background:var(--glass2);color:var(--t2);border-color:var(--b2)}
.sf-btn.ac{background:var(--accent-glow);color:var(--accent);border-color:rgba(245,158,11,.3)}

/* ═══════════════════════════════════════════════════════
   STAT CARDS
   ═══════════════════════════════════════════════════════ */
.sg{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-bottom:16px}
.sx{
  background:var(--s2);border:1px solid var(--b1);
  border-radius:var(--r-md);padding:16px;text-align:center;
  transition:border-color .15s;
}
.sx:hover{border-color:var(--b2)}
.sx.hl{border-color:rgba(245,158,11,.2);background:var(--accent-glow2)}
.sx .sl{font-size:10px;font-weight:500;text-transform:uppercase;letter-spacing:.8px;color:var(--t4);margin-bottom:6px}
.sx .sv{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700;letter-spacing:-.5px}
.sx.hl .sv{color:var(--accent)}

/* ═══════════════════════════════════════════════════════
   BUTTONS
   ═══════════════════════════════════════════════════════ */
.btn{
  padding:8px 18px;border-radius:var(--r-sm);
  font-size:12px;font-weight:500;cursor:pointer;
  transition:all .15s ease;border:1px solid;
  font-family:inherit;white-space:nowrap;
}
.btn-primary{
  background:linear-gradient(135deg,var(--accent),#d97706);
  border-color:transparent;color:#000;font-weight:600;
}
.btn-primary:hover{filter:brightness(1.1);box-shadow:0 0 20px rgba(245,158,11,.2)}
.btn-success{background:var(--proj-soft);border-color:rgba(16,185,129,.25);color:var(--proj)}
.btn-success:hover{background:rgba(16,185,129,.2);border-color:rgba(16,185,129,.4)}
.btn-danger{background:var(--comp-soft);border-color:rgba(239,68,68,.2);color:var(--comp)}
.btn-danger:hover{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.3)}
.btn-ghost{background:transparent;border-color:var(--b2);color:var(--t3)}
.btn-ghost:hover{background:var(--glass2);color:var(--t2);border-color:var(--b3)}
.btn-row{display:flex;gap:8px;flex-wrap:wrap}

/* ═══════════════════════════════════════════════════════
   MODALS
   ═══════════════════════════════════════════════════════ */
.modal-overlay{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(8px);
  -webkit-backdrop-filter:blur(8px);
  z-index:200;align-items:center;justify-content:center;
}
.modal-overlay.active{display:flex}
.modal{
  background:var(--s2);border:1px solid var(--b2);
  border-radius:var(--r-xl);padding:28px;
  max-width:440px;width:90%;
  box-shadow:var(--shadow-lg);
}
.modal h3{font-size:16px;font-weight:700;margin-bottom:14px}

/* ═══════════════════════════════════════════════════════
   TOAST
   ═══════════════════════════════════════════════════════ */
.toast{
  position:fixed;bottom:24px;right:24px;
  background:var(--s3);border:1px solid var(--b2);
  border-radius:var(--r-md);padding:12px 18px;
  box-shadow:var(--shadow-lg);z-index:1000;
  transform:translateY(120%);opacity:0;
  transition:all .3s cubic-bezier(.4,0,.2,1);
  max-width:320px;
}
.toast.show{transform:translateY(0);opacity:1}
.toast .tt{font-size:12px;font-weight:600;color:var(--accent)}
.toast .tm{font-size:12px;color:var(--t3);margin-top:2px}

/* ═══════════════════════════════════════════════════════
   EMPTY STATE
   ═══════════════════════════════════════════════════════ */
.empty{text-align:center;padding:48px 24px;color:var(--t4)}
.empty .empty-icon{font-size:40px;margin-bottom:12px;opacity:.3}
.empty .empty-text{font-size:14px;color:var(--t3)}

/* ═══════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════ */
@media(max-width:800px){
  .folder-grid{grid-template-columns:1fr 1fr}
  .g2,.g3,.g4{grid-template-columns:1fr}
  .mc{padding:20px 16px 80px}
  .hdr{padding:0 16px}
  .breadcrumb{padding:10px 16px 0}
}
@media(max-width:500px){
  .folder-grid{grid-template-columns:1fr}
  .est-total{flex-direction:column;text-align:center}
  .hi{height:auto;padding:12px 0}
}
</style>
</head>
<body>

<!-- HEADER -->
<div class="hdr"><div class="hi">
  <div class="hdr-left" onclick="goHome()">
    <div class="hdr-logo">CE</div>
    <div>
      <h1>Coatings Estimator</h1>
      <div class="sub">The Concrete Protector</div>
    </div>
  </div>
  <div class="hdr-right">
    <button class="hdr-btn" onclick="openExport()">Export</button>
    <button class="hdr-btn" onclick="openImport()">Import</button>
  </div>
</div></div>

<div class="breadcrumb" id="breadcrumb"></div>

<div class="mc">

<!-- HOME -->
<div class="screen ac" id="scr-home">
  <div class="sh"><h2>Pipeline</h2><p>Your jobs at a glance. Click any folder to view records.</p></div>
  <div class="folder-grid" id="activeFolders"></div>
  <div class="inactive-label">Archived</div>
  <div class="folder-grid" id="inactiveFolders"></div>
</div>

<!-- LIST -->
<div class="screen" id="scr-list">
  <div class="sh" id="listHeader"></div>
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:10px">
    <div class="search-bar" style="flex:1;min-width:220px"><input type="text" id="searchInput" placeholder="Search by name, company, or address..." oninput="filterList()"></div>
    <button class="btn btn-primary" id="newLeadBtn" onclick="newRecord()">+ New Lead</button>
  </div>
  <div id="listItems"></div>
</div>

<!-- RECORD -->
<div class="screen" id="scr-record">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;flex-wrap:wrap;gap:12px">
    <div class="sh" style="margin-bottom:0;flex:1" id="recordHeader"></div>
    <div class="btn-row">
      <button class="btn btn-success" onclick="saveRecord()">Save</button>
      <button class="btn btn-danger" onclick="confirmDeleteRecord()">Delete</button>
    </div>
  </div>
  <div class="cd">
    <div class="ct"><span class="ic io">&#9881;</span> Status</div>
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px">
      <div class="status-bar" id="statusPills"></div>
      <div class="active-toggle"><span>Active</span><label class="toggle"><input type="checkbox" id="recActive" onchange="toggleActive()"><span class="slider"></span></label></div>
    </div>
  </div>
  <div class="cd">
    <div class="ct"><span class="ic ib">&#9786;</span> Contact</div>
    <div class="g2">
      <div class="fg"><label>First Name</label><input type="text" id="recFirst" placeholder="First name"></div>
      <div class="fg"><label>Last Name</label><input type="text" id="recLast" placeholder="Last name"></div>
    </div>
    <div class="g2">
      <div class="fg"><label>Company</label><input type="text" id="recCompany" placeholder="Company name"></div>
      <div class="fg"><label>Email</label><input type="email" id="recEmail" placeholder="email@example.com"></div>
    </div>
    <div class="g3">
      <div class="fg"><label>Phone</label><input type="tel" id="recPhone" placeholder="(555) 123-4567"></div>
      <div class="fg"><label>Type</label><select id="recPhoneType"><option value="cell">Cell</option><option value="home">Home</option><option value="office">Office</option></select></div>
      <div class="fg"><label>Best Time to Call</label><input type="text" id="recBestTime" placeholder="e.g. After 5pm"></div>
    </div>
    <div class="fg"><label>Address</label><input type="text" id="recAddress" placeholder="Street address"></div>
    <div class="g3">
      <div class="fg"><label>City</label><input type="text" id="recCity" placeholder="City"></div>
      <div class="fg"><label>State</label><input type="text" id="recState" placeholder="State"></div>
      <div class="fg"><label>Zip</label><input type="text" id="recZip" placeholder="Zip code"></div>
    </div>
    <div class="fg"><label>Notes</label><textarea id="recNotes" placeholder="Additional notes..."></textarea></div>
  </div>
  <div class="cd">
    <div class="ct" style="justify-content:space-between"><div style="display:flex;align-items:center;gap:8px"><span class="ic ior">&#9998;</span> Estimates</div><button class="btn btn-primary" onclick="newEstimate()">+ New Estimate</button></div>
    <div id="estimatesList"></div>
  </div>
</div>

<!-- ESTIMATE -->
<div class="screen" id="scr-estimate">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;flex-wrap:wrap;gap:12px">
    <div class="sh" style="margin-bottom:0;flex:1" id="estHeader"></div>
    <div class="btn-row">
      <button class="btn btn-success" onclick="saveEstimate()">Save</button>
      <button class="btn btn-danger" onclick="confirmDeleteEstimate()">Delete Estimate</button>
    </div>
  </div>
  <div class="est-total" id="estTotalBar"></div>
  <div class="cd">
    <div class="ct" style="justify-content:space-between"><div style="display:flex;align-items:center;gap:8px"><span class="ic ig">&#9874;</span> Areas</div><button class="btn btn-primary" onclick="newSystem()">+ Add Area</button></div>
    <div id="systemsList"></div>
  </div>
</div>

<!-- SYSTEM EDITOR -->
<div class="screen" id="scr-system">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;flex-wrap:wrap;gap:12px">
    <div class="sh" style="margin-bottom:0;flex:1" id="sysHeader"></div>
    <div class="btn-row">
      <button class="btn btn-success" onclick="saveSystem()">Save</button>
      <button class="btn btn-danger" onclick="confirmDeleteSystem()">Remove</button>
    </div>
  </div>
  <div class="cd">
    <div class="ct"><span class="ic io">&#9634;</span> Dimensions</div>
    <div class="g3">
      <div class="fg"><label>Area Name</label><input type="text" id="sysArea" placeholder="e.g. Driveway, Patio, Garage" oninput="calcSystem()"></div>
      <div class="fg"><label>Length (ft)</label><input type="number" id="sysLength" value="0" min="0" step="1" oninput="calcSystem()"></div>
      <div class="fg"><label>Width (ft)</label><input type="number" id="sysWidth" value="1" min="0" step="1" oninput="calcSystem()"></div>
    </div>
    <div class="g3">
      <div class="fg"><label>Square Feet</label><input type="number" id="sysSqft" value="0" min="0" step="1" oninput="calcSystem(true)"></div>
      <div class="fg"><label>Sell Rate ($/sqft)</label><input type="number" id="sysSellRate" value="0" min="0" step="0.01" oninput="calcSystem()"></div>
      <div class="fg"><label>System Price</label>
        <div style="font-family:'JetBrains Mono',monospace;font-size:24px;font-weight:700;color:var(--accent);padding:6px 0;letter-spacing:-1px" id="sysPrice">$0.00</div>
      </div>
    </div>
  </div>
  <div class="sg" id="sysStats"></div>
  <div class="cd">
    <div class="ct"><span class="ic ior">&#9733;</span> Product System</div>
    <div class="series-filter" id="seriesFilter"></div>
    <div style="max-height:400px;overflow-y:auto;padding-right:4px" id="prodList"></div>
  </div>
  <div class="cd">
    <div class="ct"><span class="ic ig">&#9708;</span> Top Coat</div>
    <div id="tcList"></div>
  </div>
  <div class="cd">
    <div class="ct"><span class="ic ib">&#9998;</span> Notes</div>
    <div class="fg" style="margin-bottom:0"><textarea id="sysNotes" placeholder="Notes for this area..." oninput="calcSystem()"></textarea></div>
  </div>
</div>

</div>

<!-- MODALS -->
<div class="modal-overlay" id="confirmModal" onclick="if(event.target===this)closeConfirm()">
  <div class="modal">
    <h3 id="confirmTitle">Confirm</h3>
    <p style="font-size:13px;color:var(--t3);margin-bottom:20px;line-height:1.5" id="confirmMsg"></p>
    <div class="btn-row"><button class="btn btn-danger" id="confirmYes">Delete</button><button class="btn btn-ghost" onclick="closeConfirm()">Cancel</button></div>
  </div>
</div>
<div class="modal-overlay" id="exportModal" onclick="if(event.target===this)closeExport()">
  <div class="modal">
    <h3>Export Data</h3>
    <p style="font-size:13px;color:var(--t3);margin-bottom:20px;line-height:1.5">Download all records as a JSON file for backup or transfer.</p>
    <div class="btn-row"><button class="btn btn-primary" onclick="doExport()">Download</button><button class="btn btn-ghost" onclick="closeExport()">Cancel</button></div>
  </div>
</div>
<div class="modal-overlay" id="importModal" onclick="if(event.target===this)closeImport()">
  <div class="modal">
    <h3>Import Data</h3>
    <p style="font-size:13px;color:var(--t3);margin-bottom:16px;line-height:1.5">Load a previously exported JSON file. This will <strong style="color:var(--comp)">replace</strong> all current data.</p>
    <div class="fg"><input type="file" id="importFile" accept=".json" style="font-size:13px"></div>
    <div class="btn-row"><button class="btn btn-primary" onclick="doImport()">Import</button><button class="btn btn-ghost" onclick="closeImport()">Cancel</button></div>
  </div>
</div>
<div class="toast" id="toast"><div class="tt" id="toastT"></div><div class="tm" id="toastM"></div></div>

<script>
'use strict';

// ═══════════════════════════════════════════════════════════
// PRODUCT DATA
// ═══════════════════════════════════════════════════════════
const PRODUCTS=[
  {id:'c101',sku:'C-101',name:'Rustic Concrete Wood (Exterior)',series:'C-Series',cat:'Rustic & Stone',cost:1.15,low:8.00,mid:14.00},
  {id:'c102',sku:'C-102',name:'Rustic Concrete Wood (Interior)',series:'C-Series',cat:'Rustic & Stone',cost:1.43,low:8.00,mid:14.00},
  {id:'c103',sku:'C-103',name:'Grand Flagstone (Exterior)',series:'C-Series',cat:'Rustic & Stone',cost:1.15,low:8.00,mid:14.00},
  {id:'c104',sku:'C-104',name:'Grand Flagstone (Interior)',series:'C-Series',cat:'Rustic & Stone',cost:1.43,low:8.00,mid:14.00},
  {id:'c105',sku:'C-105',name:'Tuscan Slate (Exterior)',series:'C-Series',cat:'Rustic & Stone',cost:1.15,low:8.00,mid:14.00},
  {id:'c106',sku:'C-106',name:'Tuscan Slate (Interior)',series:'C-Series',cat:'Rustic & Stone',cost:1.43,low:8.00,mid:14.00},
  {id:'m201',sku:'M-201',name:'Metallic Marble Stain Gloss',series:'M-Series',cat:'Metallic & Marble',cost:3.13,low:8.50,mid:15.00},
  {id:'m202',sku:'M-202',name:'Metallic Marble Stain Satin',series:'M-Series',cat:'Metallic & Marble',cost:3.21,low:8.50,mid:15.00},
  {id:'m203',sku:'M-203',name:'Metallic Marble Stain Finish',series:'M-Series',cat:'Metallic & Marble',cost:2.73,low:8.50,mid:15.00},
  {id:'m204',sku:'M-204',name:'Italian Marble Epoxy Finish',series:'M-Series',cat:'Metallic & Marble',cost:2.76,low:9.00,mid:15.00},
  {id:'m205',sku:'M-205',name:'Italian Marble Epoxy Gloss',series:'M-Series',cat:'Metallic & Marble',cost:3.16,low:9.00,mid:15.00},
  {id:'m206',sku:'M-206',name:'Italian Marble Epoxy Satin',series:'M-Series',cat:'Metallic & Marble',cost:3.25,low:9.00,mid:15.00},
  {id:'g301',sku:'G-301',name:'Graniflex Flake Broadcast PP-90',series:'G-Series',cat:'Graniflex',cost:2.57,low:7.00,mid:9.00},
  {id:'g302',sku:'G-302',name:'Graniflex Flake Broadcast',series:'G-Series',cat:'Graniflex',cost:2.52,low:7.00,mid:9.00},
  {id:'g303',sku:'G-303',name:'Graniflex Flake Neat Coat',series:'G-Series',cat:'Graniflex',cost:2.06,low:7.00,mid:9.00},
  {id:'g304',sku:'G-304',name:'Graniflex Flake P-Thane',series:'G-Series',cat:'Graniflex',cost:2.38,low:7.00,mid:9.00},
  {id:'g305',sku:'G-305',name:'Graniflex 1-Quartz Broadcast',series:'G-Series',cat:'Graniflex',cost:2.82,low:7.50,mid:10.00},
  {id:'g306',sku:'G-306',name:'Graniflex 1-Quartz Broadcast',series:'G-Series',cat:'Graniflex',cost:2.77,low:7.50,mid:10.00},
  {id:'g307',sku:'G-307',name:'Graniflex 1-Quartz Neat',series:'G-Series',cat:'Graniflex',cost:2.19,low:7.50,mid:10.00},
  {id:'g308',sku:'G-308',name:'Graniflex 1-Quartz P-Thane',series:'G-Series',cat:'Graniflex',cost:2.59,low:7.50,mid:10.00},
  {id:'g309',sku:'G-309',name:'Graniflex 2-Quartz Broadcast',series:'G-Series',cat:'Graniflex',cost:3.54,low:8.50,mid:12.00},
  {id:'g310',sku:'G-310',name:'Graniflex 2-Quartz Broadcast',series:'G-Series',cat:'Graniflex',cost:3.08,low:8.50,mid:12.00},
  {id:'g311',sku:'G-311',name:'Marble-Flex PP-90',series:'G-Series',cat:'Graniflex',cost:2.85,low:8.50,mid:12.00},
  {id:'e401',sku:'E-401',name:'Protector-Flake P-Thane',series:'E-Series',cat:'Protector',cost:1.91,low:5.50,mid:7.50},
  {id:'e402',sku:'E-402',name:'Protector-Flake PP-90',series:'E-Series',cat:'Protector',cost:2.10,low:5.50,mid:7.50},
  {id:'e403',sku:'E-403',name:'Protector-Flake Neat Coat',series:'E-Series',cat:'Protector',cost:1.44,low:5.50,mid:7.50},
  {id:'e404',sku:'E-404',name:'Resinous 123 Floor',series:'E-Series',cat:'Protector',cost:1.05,low:3.00,mid:5.00},
  {id:'i501',sku:'I-501',name:'SCP Polish (Chemicals)',series:'I-Series',cat:'Specialty',cost:0.31,low:2.50,mid:9.00},
  {id:'i502',sku:'I-502',name:'Poly-Hard Super-Nova',series:'I-Series',cat:'Specialty',cost:2.85,low:8.00,mid:16.00},
  {id:'i503',sku:'I-503',name:'Poly-Hard Quartz PP-90',series:'I-Series',cat:'Specialty',cost:3.06,low:8.50,mid:16.00},
];
const TOPCOATS=[
  {id:'tc-none',name:'None',cost:0,desc:'No additional top coat'},
  {id:'ut4451',sku:'UT-4451',name:'Protectorthane (Interior)',cost:0.37,desc:'Interior polyurethane'},
  {id:'tj3113',sku:'TJ-3113',name:'Acrylic Floor Finish',cost:0.02,desc:'Economical acrylic'},
  {id:'ut4501',sku:'UT-4501',name:'WB 421 Gloss Urethane',cost:0.42,desc:'Water-based high-gloss'},
  {id:'ut4499',sku:'UT-4499',name:'WB 221 Satin Urethane',cost:0.50,desc:'Water-based satin'},
  {id:'en6303',sku:'EN-6303',name:'Epoxy Neat Coat',cost:0.79,desc:'Smooth epoxy finish'},
  {id:'ut4515',sku:'UT-4515',name:'Perfect Poly 90',cost:0.65,desc:'Premium polyaspartic'},
];
const STATUSES=[{id:'lead',label:'Lead',color:'lead'},{id:'estimate',label:'Estimate',color:'est'},{id:'project',label:'Project',color:'proj'},{id:'completed',label:'Completed',color:'comp'}];
const FOLDER_ICONS={lead:'&#9993;',estimate:'&#9997;',project:'&#9874;',completed:'&#10003;'};

// ═══════════════════════════════════════════════════════════
// STATE
// ═══════════════════════════════════════════════════════════
const DB_KEY='ce_database';
function loadDB(){try{return JSON.parse(localStorage.getItem(DB_KEY))||{records:[]}}catch{return{records:[]}}}
function saveDB(d){localStorage.setItem(DB_KEY,JSON.stringify(d))}
function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2,8)}
const fmt=v=>'$'+v.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
let db=loadDB();
let nav={screen:'home',folderStatus:null,folderActive:true,recordId:null,estimateId:null,systemId:null};
let seriesFilter='All';

// ═══════════════════════════════════════════════════════════
// NAVIGATION
// ═══════════════════════════════════════════════════════════
function showScreen(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('ac'));document.getElementById('scr-'+id).classList.add('ac');window.scrollTo({top:0,behavior:'smooth'})}
function goHome(){nav={screen:'home',folderStatus:null,folderActive:true,recordId:null,estimateId:null,systemId:null};renderBreadcrumb();renderHome();showScreen('home')}
function goFolder(s,a){nav.screen='list';nav.folderStatus=s;nav.folderActive=a;nav.recordId=null;nav.estimateId=null;nav.systemId=null;renderBreadcrumb();renderList();showScreen('list')}
function goRecord(id){nav.screen='record';nav.recordId=id;nav.estimateId=null;nav.systemId=null;renderBreadcrumb();renderRecord();showScreen('record')}
function goEstimate(id){nav.screen='estimate';nav.estimateId=id;nav.systemId=null;renderBreadcrumb();renderEstimate();showScreen('estimate')}
function goSystem(id){nav.screen='system';nav.systemId=id;renderBreadcrumb();renderSystem();showScreen('system')}

function renderBreadcrumb(){
  const el=document.getElementById('breadcrumb');
  let p=['<span onclick="goHome()">Home</span>'];
  if(nav.folderStatus){const st=STATUSES.find(s=>s.id===nav.folderStatus);p.push('<span class="sep">&#8250;</span>','<span onclick="goFolder(\''+nav.folderStatus+'\','+nav.folderActive+')">'+(nav.folderActive?'':'Inactive ')+st.label+'s</span>')}
  if(nav.recordId){const r=db.records.find(r=>r.id===nav.recordId);if(r){p.push('<span class="sep">&#8250;</span>','<span onclick="goRecord(\''+r.id+'\')">'+(r.firstName||r.lastName?r.firstName+' '+r.lastName:'Unnamed').trim()+'</span>')}}
  if(nav.estimateId){const r=db.records.find(r=>r.id===nav.recordId);const e=r?r.estimates.find(e=>e.id===nav.estimateId):null;if(e){p.push('<span class="sep">&#8250;</span>','<span onclick="goEstimate(\''+e.id+'\')">'+(e.name||'Estimate')+'</span>')}}
  if(nav.systemId){const r=db.records.find(r=>r.id===nav.recordId);const e=r?r.estimates.find(e=>e.id===nav.estimateId):null;const s=e?e.systems.find(s=>s.id===nav.systemId):null;if(s)p.push('<span class="sep">&#8250;</span>','<span class="current">'+(s.areaName||'New Area')+'</span>')}
  el.innerHTML=p.join('');
}

// ═══════════════════════════════════════════════════════════
// HOME
// ═══════════════════════════════════════════════════════════
function renderHome(){
  const c={};STATUSES.forEach(s=>{c[s.id]={active:0,inactive:0}});
  db.records.forEach(r=>{if(c[r.status])c[r.status][r.active?'active':'inactive']++});
  document.getElementById('activeFolders').innerHTML=STATUSES.map(s=>'<div class="folder '+s.color+'" onclick="goFolder(\''+s.id+'\',true)"><div class="f-glow"></div><div class="f-icon">'+FOLDER_ICONS[s.id]+'</div><div class="f-count">'+c[s.id].active+'</div><div class="f-label">'+s.label+'s</div><div class="f-sub">active records</div></div>').join('');
  document.getElementById('inactiveFolders').innerHTML=STATUSES.map(s=>'<div class="folder '+s.color+' inactive" onclick="goFolder(\''+s.id+'\',false)"><div class="f-icon">'+FOLDER_ICONS[s.id]+'</div><div class="f-count">'+c[s.id].inactive+'</div><div class="f-label">Inactive '+s.label+'s</div></div>').join('');
}

// ═══════════════════════════════════════════════════════════
// LIST
// ═══════════════════════════════════════════════════════════
function renderList(){
  const st=STATUSES.find(s=>s.id===nav.folderStatus);
  const prefix=nav.folderActive?'':'Inactive ';
  document.getElementById('listHeader').innerHTML='<h2>'+prefix+st.label+'s</h2><p>'+getListDesc(st.id,nav.folderActive)+'</p>';
  document.getElementById('newLeadBtn').style.display=(nav.folderStatus==='lead'&&nav.folderActive)?'':'none';
  document.getElementById('searchInput').value='';filterList();
}
function getListDesc(s,a){if(!a)return'Archived records.';return{lead:'New contacts and inquiries.',estimate:'Leads with quotes ready for review.',project:'Jobs on your calendar.',completed:'Finished jobs.'}[s]||''}
function filterList(){
  const q=(document.getElementById('searchInput').value||'').toLowerCase();
  const items=db.records.filter(r=>r.status===nav.folderStatus&&r.active===nav.folderActive);
  const f=q?items.filter(r=>[r.firstName,r.lastName,r.company,r.address,r.city,r.email].join(' ').toLowerCase().includes(q)):items;
  if(!f.length){document.getElementById('listItems').innerHTML='<div class="empty"><div class="empty-icon">&#128194;</div><div class="empty-text">No records here yet.</div></div>';return}
  document.getElementById('listItems').innerHTML=f.map(r=>{
    const name=(r.firstName||'')+' '+(r.lastName||'');
    const ini=((r.firstName||'?')[0]+(r.lastName||'?')[0]).toUpperCase();
    const ec=r.estimates.length;
    const tot=r.estimates.reduce((s,e)=>s+e.systems.reduce((s2,sys)=>s2+(sys.sqft*(sys.sellRate||0)),0),0);
    const meta=[r.company,r.city&&r.state?r.city+', '+r.state:r.city||r.state,ec?ec+' estimate'+(ec>1?'s':''):''].filter(Boolean).join(' \u00b7 ');
    return'<div class="list-item" onclick="goRecord(\''+r.id+'\')"><div class="li-left"><div class="li-avatar '+r.status+'">'+ini+'</div><div><div class="li-name">'+name.trim()+'</div><div class="li-meta">'+meta+'</div></div></div><div class="li-right">'+(tot>0?'<div class="li-amount">'+fmt(tot)+'</div>':'')+'<div class="li-badge '+r.status+'">'+r.status+'</div></div></div>'
  }).join('');
}

// ═══════════════════════════════════════════════════════════
// RECORD
// ═══════════════════════════════════════════════════════════
function getRecord(){return db.records.find(r=>r.id===nav.recordId)}
function renderRecord(){
  const rec=getRecord();if(!rec){goHome();return}
  const name=((rec.firstName||'')+' '+(rec.lastName||'')).trim()||'New Lead';
  document.getElementById('recordHeader').innerHTML='<h2>'+name+'</h2>'+(rec.company?'<p>'+rec.company+'</p>':'');
  document.getElementById('statusPills').innerHTML=STATUSES.map(s=>'<button class="status-pill '+s.color+(rec.status===s.id?' active':'')+'" onclick="changeStatus(\''+s.id+'\')">'+s.label+'</button>').join('');
  document.getElementById('recActive').checked=rec.active;
  document.getElementById('recFirst').value=rec.firstName||'';
  document.getElementById('recLast').value=rec.lastName||'';
  document.getElementById('recCompany').value=rec.company||'';
  document.getElementById('recEmail').value=rec.email||'';
  document.getElementById('recPhone').value=rec.phone||'';
  document.getElementById('recPhoneType').value=rec.phoneType||'cell';
  document.getElementById('recBestTime').value=rec.bestTimeToCall||'';
  document.getElementById('recAddress').value=rec.address||'';
  document.getElementById('recCity').value=rec.city||'';
  document.getElementById('recState').value=rec.state||'';
  document.getElementById('recZip').value=rec.zip||'';
  document.getElementById('recNotes').value=rec.notes||'';
  renderEstimatesList(rec);
}
function renderEstimatesList(rec){
  if(!rec.estimates.length){document.getElementById('estimatesList').innerHTML='<div class="empty"><div class="empty-icon">&#9997;</div><div class="empty-text">No estimates yet. Create one to start quoting.</div></div>';return}
  document.getElementById('estimatesList').innerHTML=rec.estimates.map(est=>{
    const tot=est.systems.reduce((s,sys)=>s+(sys.sqft*(sys.sellRate||0)),0);
    const cost=est.systems.reduce((s,sys)=>{const p=PRODUCTS.find(p=>p.id===sys.productId);const t=TOPCOATS.find(t=>t.id===sys.topcoatId);return s+(p?p.cost*sys.sqft:0)+(t?t.cost*sys.sqft:0)},0);
    const sqft=est.systems.reduce((s,sys)=>s+sys.sqft,0);
    const areas=est.systems.map(s=>s.areaName||'Unnamed').join(', ');
    return'<div class="sys-card'+(tot>0?' has-product':'')+'" onclick="goEstimate(\''+est.id+'\')"><div><div class="sys-area">'+(est.name||'Estimate')+'</div><div class="sys-detail">'+est.systems.length+' area'+(est.systems.length!==1?'s':'')+' \u00b7 '+sqft.toLocaleString()+' sqft'+(areas?' \u00b7 '+areas:'')+'</div></div><div class="sys-right"><div class="sys-price">'+fmt(tot)+'</div>'+(cost>0?'<div class="sys-cost">Cost '+fmt(cost)+'</div>':'')+'</div></div>'
  }).join('');
}
function saveRecord(){
  const rec=getRecord();if(!rec)return;
  rec.firstName=document.getElementById('recFirst').value.trim();
  rec.lastName=document.getElementById('recLast').value.trim();
  rec.company=document.getElementById('recCompany').value.trim();
  rec.email=document.getElementById('recEmail').value.trim();
  rec.phone=document.getElementById('recPhone').value.trim();
  rec.phoneType=document.getElementById('recPhoneType').value;
  rec.bestTimeToCall=document.getElementById('recBestTime').value.trim();
  rec.address=document.getElementById('recAddress').value.trim();
  rec.city=document.getElementById('recCity').value.trim();
  rec.state=document.getElementById('recState').value.trim();
  rec.zip=document.getElementById('recZip').value.trim();
  rec.notes=document.getElementById('recNotes').value.trim();
  rec.updatedAt=new Date().toISOString();
  saveDB(db);renderBreadcrumb();toast('Saved','Record updated.');
}
function changeStatus(s){const rec=getRecord();if(!rec)return;rec.status=s;rec.active=true;rec.updatedAt=new Date().toISOString();saveDB(db);nav.folderStatus=s;nav.folderActive=true;renderRecord();renderBreadcrumb();toast('Moved','Now in '+STATUSES.find(x=>x.id===s).label+'s.')}
function toggleActive(){const rec=getRecord();if(!rec)return;rec.active=document.getElementById('recActive').checked;rec.updatedAt=new Date().toISOString();saveDB(db);nav.folderActive=rec.active;renderBreadcrumb();toast(rec.active?'Active':'Archived',rec.active?'Record is active.':'Moved to inactive.')}
function newRecord(){const rec={id:uid(),status:'lead',active:true,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),firstName:'',lastName:'',company:'',email:'',phone:'',phoneType:'cell',bestTimeToCall:'',address:'',city:'',state:'',zip:'',notes:'',estimates:[]};db.records.unshift(rec);saveDB(db);goRecord(rec.id);toast('New Lead','Enter contact details.')}
function confirmDeleteRecord(){openConfirm('Delete Record','Permanently delete this record and all estimates?',()=>{db.records=db.records.filter(r=>r.id!==nav.recordId);saveDB(db);goFolder(nav.folderStatus,nav.folderActive);toast('Deleted','Record removed.')})}

// ═══════════════════════════════════════════════════════════
// ESTIMATE
// ═══════════════════════════════════════════════════════════
function getEstimate(){const rec=getRecord();return rec?rec.estimates.find(e=>e.id===nav.estimateId):null}
function renderEstimate(){
  const est=getEstimate();const rec=getRecord();if(!est||!rec){goRecord(nav.recordId);return}
  const rn=((rec.firstName||'')+' '+(rec.lastName||'')).trim()||'Client';
  document.getElementById('estHeader').innerHTML='<h2>'+(est.name||'Estimate')+'</h2><p>'+rn+'</p>';
  const tp=est.systems.reduce((s,sys)=>s+(sys.sqft*(sys.sellRate||0)),0);
  const tc=est.systems.reduce((s,sys)=>{const p=PRODUCTS.find(p=>p.id===sys.productId);const t=TOPCOATS.find(t=>t.id===sys.topcoatId);return s+(p?p.cost*sys.sqft:0)+(t?t.cost*sys.sqft:0)},0);
  const sqft=est.systems.reduce((s,sys)=>s+sys.sqft,0);
  const mg=tp>0?((tp-tc)/tp*100):0;
  document.getElementById('estTotalBar').innerHTML='<div><div class="est-total-left">Estimate Total</div><div class="est-total-detail">'+est.systems.length+' area'+(est.systems.length!==1?'s':'')+' \u00b7 '+sqft.toLocaleString()+' sqft</div></div><div style="text-align:right"><div class="est-total-amount">'+fmt(tp)+'</div><div class="est-total-detail">Cost '+fmt(tc)+' \u00b7 Margin '+mg.toFixed(1)+'%</div></div>';
  if(!est.systems.length){document.getElementById('systemsList').innerHTML='<div class="empty"><div class="empty-icon">&#9874;</div><div class="empty-text">Add an area to start building this estimate.</div></div>';return}
  document.getElementById('systemsList').innerHTML=est.systems.map((sys,i)=>{
    const prod=PRODUCTS.find(p=>p.id===sys.productId);const tc=TOPCOATS.find(t=>t.id===sys.topcoatId);
    const pr=sys.sqft*(sys.sellRate||0);const co=(prod?prod.cost*sys.sqft:0)+(tc?tc.cost*sys.sqft:0);
    const d=[sys.sqft?sys.sqft.toLocaleString()+' sqft':'',prod?prod.name:'No system',sys.sellRate?'$'+sys.sellRate.toFixed(2)+'/sqft':''].filter(Boolean).join(' \u00b7 ');
    return'<div class="sys-card'+(prod?' has-product':'')+'" onclick="goSystem(\''+sys.id+'\')"><div><div class="sys-area">'+(sys.areaName||'Area '+(i+1))+'</div><div class="sys-detail">'+d+'</div></div><div class="sys-right"><div class="sys-price">'+fmt(pr)+'</div>'+(co>0?'<div class="sys-cost">Cost '+fmt(co)+'</div>':'')+'</div></div>'
  }).join('');
}
function newEstimate(){const rec=getRecord();if(!rec)return;saveRecord();const c=rec.estimates.length+1;const est={id:uid(),name:'Estimate #'+c,createdAt:new Date().toISOString(),systems:[]};rec.estimates.push(est);rec.updatedAt=new Date().toISOString();if(rec.status==='lead'){rec.status='estimate';nav.folderStatus='estimate'}saveDB(db);goEstimate(est.id);toast('Created','Add areas to start quoting.')}
function saveEstimate(){saveDB(db);toast('Saved','Estimate saved.')}
function confirmDeleteEstimate(){const rec=getRecord();if(!rec)return;openConfirm('Delete Estimate','Delete this estimate and all areas?',()=>{rec.estimates=rec.estimates.filter(e=>e.id!==nav.estimateId);rec.updatedAt=new Date().toISOString();saveDB(db);goRecord(nav.recordId);toast('Deleted','Estimate removed.')})}

// ═══════════════════════════════════════════════════════════
// SYSTEM EDITOR
// ═══════════════════════════════════════════════════════════
function getSystem(){const est=getEstimate();return est?est.systems.find(s=>s.id===nav.systemId):null}
function renderSystem(){
  const sys=getSystem();if(!sys){goEstimate(nav.estimateId);return}
  document.getElementById('sysHeader').innerHTML='<h2>'+(sys.areaName||'New Area')+'</h2><p>Select a product system and set your sell rate.</p>';
  document.getElementById('sysArea').value=sys.areaName||'';
  document.getElementById('sysLength').value=sys.length||0;
  document.getElementById('sysWidth').value=sys.width||1;
  document.getElementById('sysSqft').value=sys.sqft||0;
  document.getElementById('sysSellRate').value=sys.sellRate||0;
  document.getElementById('sysNotes').value=sys.notes||'';
  seriesFilter='All';renderSeriesFilter();renderProductList(sys);renderTopcoatList(sys);calcSystem();
}
function renderSeriesFilter(){const s=['All','C-Series','M-Series','G-Series','E-Series','I-Series'];document.getElementById('seriesFilter').innerHTML=s.map(x=>'<button class="sf-btn'+(x===seriesFilter?' ac':'')+'" onclick="setSeriesFilter(\''+x+'\')">'+x+'</button>').join('')}
function setSeriesFilter(s){seriesFilter=s;renderSeriesFilter();const sys=getSystem();if(sys)renderProductList(sys)}
function renderProductList(sys){
  const ps=seriesFilter==='All'?PRODUCTS:PRODUCTS.filter(p=>p.series===seriesFilter);
  document.getElementById('prodList').innerHTML=ps.map(p=>{const sel=sys.productId===p.id;return'<div class="prod-option'+(sel?' sel':'')+'" onclick="selectProduct(\''+p.id+'\')"><div><div class="prod-name">'+p.name+'</div><div class="prod-sku">'+p.sku+' \u00b7 '+p.cat+'</div></div><div class="prod-prices"><div class="cost">'+fmt(p.cost)+'/sf</div><div class="sell">Sell '+fmt(p.low)+'\u2013'+fmt(p.mid)+'</div></div></div>'}).join('');
}
function renderTopcoatList(sys){
  document.getElementById('tcList').innerHTML=TOPCOATS.map(t=>{const sel=(sys.topcoatId||'tc-none')===t.id;return'<div class="prod-option'+(sel?' sel':'')+'" onclick="selectTopcoat(\''+t.id+'\')"><div><div class="prod-name">'+t.name+'</div>'+(t.desc?'<div class="prod-sku">'+t.desc+'</div>':'')+'</div><div class="prod-prices"><div class="cost">'+(t.cost>0?fmt(t.cost)+'/sf':'\u2014')+'</div></div></div>'}).join('');
}
function selectProduct(id){const sys=getSystem();if(!sys)return;sys.productId=id;const p=PRODUCTS.find(p=>p.id===id);if(p&&!sys.sellRate){sys.sellRate=p.low;document.getElementById('sysSellRate').value=p.low.toFixed(2)}renderProductList(sys);calcSystem()}
function selectTopcoat(id){const sys=getSystem();if(!sys)return;sys.topcoatId=id==='tc-none'?null:id;renderTopcoatList(sys);calcSystem()}
function calcSystem(sqm){
  const sys=getSystem();if(!sys)return;
  const l=parseFloat(document.getElementById('sysLength').value)||0;
  const w=parseFloat(document.getElementById('sysWidth').value)||1;
  let sq=sqm?(parseFloat(document.getElementById('sysSqft').value)||0):(l*w);
  if(!sqm)document.getElementById('sysSqft').value=sq;
  const sr=parseFloat(document.getElementById('sysSellRate').value)||0;
  const pr=sq*sr;document.getElementById('sysPrice').textContent=fmt(pr);
  sys.areaName=document.getElementById('sysArea').value.trim();sys.length=l;sys.width=w;sys.sqft=sq;sys.sellRate=sr;sys.notes=document.getElementById('sysNotes').value.trim();
  const prod=PRODUCTS.find(p=>p.id===sys.productId);const tc=TOPCOATS.find(t=>t.id===sys.topcoatId);
  const mc=(prod?prod.cost*sq:0)+(tc?tc.cost*sq:0);const mg=pr>0?((pr-mc)/pr*100):0;const pf=pr-mc;
  document.getElementById('sysStats').innerHTML='<div class="sx hl"><div class="sl">System Price</div><div class="sv">'+fmt(pr)+'</div></div><div class="sx"><div class="sl">Material Cost</div><div class="sv" style="color:var(--comp)">'+fmt(mc)+'</div></div><div class="sx"><div class="sl">Gross Profit</div><div class="sv" style="color:var(--success)">'+fmt(pf)+'</div></div><div class="sx"><div class="sl">Margin</div><div class="sv" style="color:'+(mg>=50?'var(--success)':mg>=30?'var(--accent)':'var(--comp)')+'">'+mg.toFixed(1)+'%</div></div>';
}
function saveSystem(){calcSystem();saveDB(db);renderBreadcrumb();toast('Saved','Area saved.')}
function newSystem(){const est=getEstimate();if(!est)return;const sys={id:uid(),areaName:'',length:0,width:1,sqft:0,productId:null,sellRate:0,topcoatId:null,notes:''};est.systems.push(sys);saveDB(db);goSystem(sys.id)}
function confirmDeleteSystem(){const est=getEstimate();if(!est)return;openConfirm('Remove Area','Remove this area from the estimate?',()=>{est.systems=est.systems.filter(s=>s.id!==nav.systemId);saveDB(db);goEstimate(nav.estimateId);toast('Removed','Area removed.')})}

// ═══════════════════════════════════════════════════════════
// MODALS / TOAST / IMPORT-EXPORT
// ═══════════════════════════════════════════════════════════
function openConfirm(t,m,fn){document.getElementById('confirmTitle').textContent=t;document.getElementById('confirmMsg').textContent=m;document.getElementById('confirmYes').onclick=()=>{closeConfirm();fn()};document.getElementById('confirmModal').classList.add('active')}
function closeConfirm(){document.getElementById('confirmModal').classList.remove('active')}
function openExport(){document.getElementById('exportModal').classList.add('active')}
function closeExport(){document.getElementById('exportModal').classList.remove('active')}
function openImport(){document.getElementById('importModal').classList.add('active')}
function closeImport(){document.getElementById('importModal').classList.remove('active')}
function toast(t,m){const el=document.getElementById('toast');document.getElementById('toastT').textContent=t;document.getElementById('toastM').textContent=m;el.classList.add('show');setTimeout(()=>el.classList.remove('show'),3000)}
function doExport(){const b=new Blob([JSON.stringify(db,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='coatings-estimator-'+new Date().toISOString().slice(0,10)+'.json';a.click();closeExport();toast('Exported','Download started.')}
function doImport(){const f=document.getElementById('importFile').files[0];if(!f){toast('Error','Select a file.');return}const r=new FileReader();r.onload=e=>{try{const d=JSON.parse(e.target.result);if(d.records&&Array.isArray(d.records)){db=d;saveDB(db);closeImport();goHome();toast('Imported',db.records.length+' records loaded.')}else{toast('Error','Invalid format.')}}catch{toast('Error','Could not parse file.')}};r.readAsText(f)}

// ═══════════════════════════════════════════════════════════
// INIT
// ═══════════════════════════════════════════════════════════
renderHome();renderBreadcrumb();
</script>
</body>
</html>
